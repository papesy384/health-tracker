<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weight Tracking</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .automation-status {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active { background: #4CAF50; }
        .status-inactive { background: #f44336; }

        .form {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .input-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
        }

        .form input,
        .form select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form input:focus,
        .form select:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-loading {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            cursor: not-allowed;
        }

        .email-status {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            font-family: monospace;
            font-size: 0.9rem;
            display: none;
        }

        .status-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .status-loading {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        /* Health Plan Results Styles */
        .bmi-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .bmi-value {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .bmi-category {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .meal-plan {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .meal-plan h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .meal-plan h5 {
            color: #495057;
            margin: 15px 0 10px 0;
            font-size: 1.1rem;
        }

        .meal-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .meal-option {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            font-size: 0.95rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .timeline {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 20px;
        }

        .timeline h4 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .timeline-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .timeline-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .timeline-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #856404;
        }

        .timeline-label {
            font-size: 0.9rem;
            color: #856404;
            margin-top: 5px;
        }

        .action-buttons {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        /* Meal Plan Results Styles */
        .bmi-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .bmi-value {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .bmi-category {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .meal-plan {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .meal-plan h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .meal-plan h5 {
            color: #495057;
            margin: 15px 0 10px 0;
            font-size: 1.1rem;
        }

        .meal-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .meal-option {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            font-size: 0.95rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .timeline {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 20px;
        }

        .timeline h4 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .timeline-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .timeline-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .timeline-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #856404;
        }

        .timeline-label {
            font-size: 0.9rem;
            color: #856404;
            margin-top: 5px;
        }

        /* Back Button Styles */
        .back-button {
            margin-bottom: 20px;
        }

        .btn-back {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .btn-back:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #5a6268 0%, #343a40 100%);
        }

        /* Reset Button Styles */
        .btn-reset {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .btn-reset:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
        }

        /* Authentication Page Styles */
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .auth-header p {
            color: #7f8c8d;
            font-size: 1rem;
        }

        /* Auth Tabs */
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            background: #ecf0f1;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: #d5dbdb;
            color: #2c3e50;
        }

        /* Auth Forms */
        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
        }

        .auth-footer p {
            margin: 8px 0;
            color: #7f8c8d;
        }

        .auth-footer a {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }

        .auth-footer a:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        /* Auth Form Specific Styles */
        #authSection .form {
            max-width: 450px;
            margin: 0 auto;
        }

        #authSection .input-group {
            margin-bottom: 20px;
        }

        #authSection .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        #authSection .input-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        #authSection .btn {
            width: 100%;
            margin-top: 10px;
        }

        /* Terms and Privacy Links */
        .checkbox-group a {
            color: #3498db;
            text-decoration: none;
        }

        .checkbox-group a:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 10px;
            }

            .input-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-weight"></i> Weight Tracking</h1>
        </div>

        <!-- Authentication Section -->
        <div id="authSection">
            <div class="form">
                <div class="auth-header">
                    <h2><i class="fas fa-user-circle"></i> Welcome to Weight Tracking</h2>
                    <p>Sign in to your account or create a new one</p>
                </div>

                <!-- Auth Tabs -->
                <div class="auth-tabs">
                    <button class="tab-btn active" id="signInTab" onclick="switchTab('signIn')">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                    <button class="tab-btn" id="signUpTab" onclick="switchTab('signUp')">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </div>

                <!-- Sign In Form -->
                <div id="signInForm" class="auth-form active">
                    <div class="input-group">
                        <label for="loginEmail">Email or User ID</label>
                        <input type="text" id="loginEmail" placeholder="Enter your email or user ID">
                    </div>

                    <div class="input-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password">
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="rememberMe">
                        <label for="rememberMe">Remember me</label>
                    </div>

                    <button class="btn" onclick="performLogin()">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>

                    <div class="auth-footer">
                        <p><a href="#" onclick="showForgotPassword()">Forgot your password?</a></p>
                    </div>
                </div>

                <!-- Sign Up Form -->
                <div id="signUpForm" class="auth-form">
                    <div class="input-group">
                        <label for="signupName">Full Name</label>
                        <input type="text" id="signupName" placeholder="Enter your full name">
                    </div>

                    <div class="input-group">
                        <label for="signupEmail">Email Address</label>
                        <input type="email" id="signupEmail" placeholder="Enter your email address">
                    </div>

                    <div class="input-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" placeholder="Create a password">
                    </div>

                    <div class="input-group">
                        <label for="signupConfirmPassword">Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" placeholder="Confirm your password">
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="agreeTerms">
                        <label for="agreeTerms">I agree to the <a href="#" onclick="showTerms()">Terms of Service</a> and <a href="#" onclick="showPrivacy()">Privacy Policy</a></label>
                    </div>

                    <button class="btn" onclick="performSignup()">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>

                    <div class="auth-footer">
                        <p>Already have an account? <a href="#" onclick="switchTab('signIn')">Sign in here</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application Section (Hidden Initially) -->
        <div id="mainAppSection" style="display: none;">
            <div class="automation-status">
                <span class="status-indicator status-inactive" id="statusIndicator"></span>
                <strong>Automation Status:</strong> <span id="statusText">Inactive</span>
                <button class="btn btn-logout" onclick="logout()" style="float: right; padding: 8px 16px; font-size: 0.9rem;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>

            <div class="form">
            <div class="input-group">
                <label for="weight">Weight</label>
                <div class="input-row">
                    <input type="number" id="weight" placeholder="Enter weight" step="0.1" min="0">
                    <select id="weightUnit">
                        <option value="kg">kg</option>
                        <option value="lbs">lbs</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label for="height">Height</label>
                <div class="input-row">
                    <input type="number" id="height" placeholder="Enter height" step="0.1" min="0">
                    <select id="heightUnit">
                        <option value="cm">cm</option>
                        <option value="in">in</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label for="sleepHours">Weekly Sleep Hours</label>
                <input type="number" id="sleepHours" placeholder="e.g., 56" step="0.5" min="0">
            </div>

            <div class="input-group">
                <label for="exerciseMinutes">Weekly Exercise Minutes</label>
                <input type="number" id="exerciseMinutes" placeholder="e.g., 150 (0 if none)" step="1" min="0">
            </div>

            <div class="input-group">
                <label for="weightGoal">Target Weight (Optional)</label>
                <div class="input-row">
                    <input type="number" id="weightGoal" placeholder="Enter target weight" step="0.1" min="0">
                    <select id="goalUnit">
                        <option value="kg">kg</option>
                        <option value="lbs">lbs</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label for="email">Email (for automatic reports)</label>
                <input type="email" id="email" placeholder="your@email.com">
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="automationEnabled" onchange="toggleAutomation()">
                <label for="automationEnabled">Enable Weekly Automation (Sundays at 9 AM)</label>
            </div>

            <button class="btn" id="generateBtn" onclick="generateRecommendations()">Generate Health Plan</button>
            <button class="btn btn-secondary" onclick="sendEmailAutomatically()" id="sendEmailBtn">Send Email Automatically</button>
            <button class="btn btn-reset" onclick="resetAllData()">
                <i class="fas fa-undo"></i> Reset All Data
            </button>
        </div>

        </div>

        <!-- Meal Plan Dashboard Section -->
        <div id="mealPlanDashboard" style="display: none;">
            <div class="form">
                <!-- Back Button -->
                <div class="back-button">
                    <button class="btn btn-back" onclick="goBackToForm()">
                        <i class="fas fa-arrow-left"></i> Back to Form
                    </button>
                </div>
                
                <div class="header">
                    <h2><i class="fas fa-utensils"></i> Your Meal Plan & Timeline</h2>
                    <p>Personalized meal plan and weight tracking</p>
                </div>
                
                <div class="bmi-display">
                    <div class="bmi-value" id="resultBmiValue">0.0</div>
                    <div class="bmi-category" id="resultBmiCategory">Normal</div>
                </div>

                <div class="meal-plan">
                    <h4><i class="fas fa-utensils"></i> Comprehensive Meal Plan</h4>
                    <div id="mealPlanContent"></div>
                </div>

                <div class="timeline" id="timelineSection">
                    <h4><i class="fas fa-calendar-alt"></i> Weight Goal Timeline</h4>
                    <div id="timelineContent"></div>
                </div>

                <div class="action-buttons">
                    <button class="btn" onclick="sendEmailAutomatically()">
                        <i class="fas fa-envelope"></i> Send Email Report
                    </button>
                    <button class="btn btn-secondary" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Plan
                    </button>
                    <button class="btn btn-reset" onclick="resetAllData()">
                        <i class="fas fa-undo"></i> Reset All Data
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Weight Tracking JavaScript
        
        // Global state
        let userData = {
            weight: null,
            height: null,
            sleepHours: null,
            exerciseMinutes: null,
            weightGoal: null,
            email: null,
            lastWorkflowRun: null,
            automationEnabled: false
        };

        // Login state
        let currentUser = null;
        let isLoggedIn = false;

        // Current health report data
        let currentReport = null;

        // Authentication Functions
        function switchTab(tab) {
            console.log('Switching to tab:', tab);
            
            // Remove active class from all tabs and forms
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            
            if (tab === 'signIn') {
                document.getElementById('signInTab').classList.add('active');
                document.getElementById('signInForm').classList.add('active');
            } else if (tab === 'signUp') {
                document.getElementById('signUpTab').classList.add('active');
                document.getElementById('signUpForm').classList.add('active');
            }
        }
        
        function performLogin() {
            console.log('Login attempt');
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Basic validation
            if (!email || !password) {
                alert('Please enter both email/user ID and password');
                return;
            }
            
            // Simple authentication (in real app, this would be server-side)
            if (authenticateUser(email, password)) {
                console.log('Login successful');
                
                // Set login state
                currentUser = email;
                isLoggedIn = true;
                
                // Remember user if checkbox is checked
                if (rememberMe) {
                    localStorage.setItem('rememberedUser', email);
                }
                
                // Show main app
                showMainApp();
                
                // Show success message
                alert('Login successful! Welcome to your health tracking dashboard.');
            } else {
                console.log('Login failed');
                alert('Invalid credentials. Please try again.');
            }
        }
        
        function performSignup() {
            console.log('Signup attempt');
            
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value.trim();
            const confirmPassword = document.getElementById('signupConfirmPassword').value.trim();
            const agreeTerms = document.getElementById('agreeTerms').checked;
            
            // Basic validation
            if (!name || !email || !password || !confirmPassword) {
                alert('Please fill in all fields');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }
            
            if (!agreeTerms) {
                alert('Please agree to the Terms of Service and Privacy Policy');
                return;
            }
            
            // Check if user already exists
            if (userExists(email)) {
                alert('An account with this email already exists. Please sign in instead.');
                switchTab('signIn');
                return;
            }
            
            // Create new user account
            if (createUserAccount(name, email, password)) {
                console.log('Signup successful');
                
                // Set login state
                currentUser = email;
                isLoggedIn = true;
                
                // Show main app
                showMainApp();
                
                // Show success message
                alert('Account created successfully! Welcome to Weight Tracking!');
            } else {
                console.log('Signup failed');
                alert('Failed to create account. Please try again.');
            }
        }
        
        function authenticateUser(email, password) {
            // Simple demo authentication
            // In a real app, this would be a server call
            const validUsers = {
                'admin': 'admin123',
                'user': 'user123',
                'demo': 'demo123',
                'test@example.com': 'test123'
            };
            
            return validUsers[email] === password;
        }
        
        function userExists(email) {
            // Check if user already exists in localStorage
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '{}');
            return users.hasOwnProperty(email);
        }
        
        function createUserAccount(name, email, password) {
            try {
                // Get existing users
                const users = JSON.parse(localStorage.getItem('registeredUsers') || '{}');
                
                // Add new user
                users[email] = {
                    name: name,
                    email: email,
                    password: password, // In real app, this would be hashed
                    createdAt: new Date().toISOString()
                };
                
                // Save to localStorage
                localStorage.setItem('registeredUsers', JSON.stringify(users));
                
                console.log('User account created:', email);
                return true;
            } catch (error) {
                console.error('Error creating user account:', error);
                return false;
            }
        }
        
        function showMainApp() {
            console.log('Showing main app');
            
            // Hide auth section
            document.getElementById('authSection').style.display = 'none';
            
            // Show main app section
            document.getElementById('mainAppSection').style.display = 'block';
            
            // Load user data
            loadUserData();
        }
        
        function showForgotPassword() {
            alert('Password reset functionality would be implemented here. For demo purposes, use:\n\nEmail: admin\nPassword: admin123\n\nOr\n\nEmail: user\nPassword: user123');
        }
        
        function showTerms() {
            alert('Terms of Service:\n\n1. Use this application responsibly\n2. Keep your health data secure\n3. Consult healthcare professionals for medical advice\n4. We respect your privacy and data');
        }
        
        function showPrivacy() {
            alert('Privacy Policy:\n\n1. Your data is stored locally in your browser\n2. We do not collect personal information\n3. Email reports are sent only when you request them\n4. You can reset all data at any time');
        }
        
        function logout() {
            console.log('Logging out');
            
            // Clear login state
            currentUser = null;
            isLoggedIn = false;
            
            // Clear remembered user
            localStorage.removeItem('rememberedUser');
            
            // Hide main app
            document.getElementById('mainAppSection').style.display = 'none';
            
            // Show auth section
            document.getElementById('authSection').style.display = 'block';
            
            // Clear form fields
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('rememberMe').checked = false;
            document.getElementById('signupName').value = '';
            document.getElementById('signupEmail').value = '';
            document.getElementById('signupPassword').value = '';
            document.getElementById('signupConfirmPassword').value = '';
            document.getElementById('agreeTerms').checked = false;
            
            // Switch to sign in tab
            switchTab('signIn');
            
            console.log('Logged out successfully');
        }

        // EmailJS Configuration (Public keys - safe to expose)
        const EMAILJS_CONFIG = {
            serviceId: 'service_health_tracker',
            templateId: 'template_health_report',
            publicKey: 'your_public_key_here'
        };

        // Initialize EmailJS
        function initializeEmailJS() {
            try {
                emailjs.init(EMAILJS_CONFIG.publicKey);
                console.log('📧 EmailJS initialized successfully');
                return true;
            } catch (error) {
                console.error('📧 EmailJS initialization failed:', error);
                return false;
            }
        }

        // Load saved data from localStorage
        function loadUserData() {
            const saved = localStorage.getItem('healthTrackerData');
            if (saved) {
                userData = { ...userData, ...JSON.parse(saved) };
                populateForm();
                updateAutomationStatus();
            }
        }

        // Save data to localStorage
        function saveUserData() {
            localStorage.setItem('healthTrackerData', JSON.stringify(userData));
        }

        // Populate form with saved data
        function populateForm() {
            if (userData.weight) document.getElementById('weight').value = userData.weight;
            if (userData.height) document.getElementById('height').value = userData.height;
            if (userData.sleepHours) document.getElementById('sleepHours').value = userData.sleepHours;
            if (userData.exerciseMinutes !== null) document.getElementById('exerciseMinutes').value = userData.exerciseMinutes;
            if (userData.weightGoal) document.getElementById('weightGoal').value = userData.weightGoal;
            if (userData.email) document.getElementById('email').value = userData.email;
            if (userData.automationEnabled) document.getElementById('automationEnabled').checked = true;
        }

        // Update automation status display
        function updateAutomationStatus() {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            if (userData.automationEnabled) {
                indicator.className = 'status-indicator status-active';
                statusText.textContent = 'Active - Next run: Sunday 9:00 AM';
            } else {
                indicator.className = 'status-indicator status-inactive';
                statusText.textContent = 'Inactive';
            }
        }

        // Toggle automation
        function toggleAutomation() {
            userData.automationEnabled = document.getElementById('automationEnabled').checked;
            saveUserData();
            updateAutomationStatus();
            
            if (userData.automationEnabled) {
                showNotification('🤖 Weekly automation enabled! Reports will be sent every Sunday at 9 AM.');
            } else {
                showNotification('⏸️ Weekly automation disabled.');
            }
        }

        // Send email automatically using multiple services
        async function sendEmailAutomatically() {
            console.log('📧 sendEmailAutomatically called');
            
            // Check if we have current report
            if (!currentReport) {
                alert('Please generate a health plan first');
                return;
            }
            
            // Check if we have email
            if (!userData.email) {
                alert('Please enter your email address first');
                return;
            }
            
            // Show loading state
            setEmailStatus('loading', 'Sending email automatically...');
            setButtonLoading(true);
            
            const { bmi, bmiCategory, dietRecs, sleepRecs, mealPlan } = currentReport;
            const emailContent = generateEmailContent(bmi, bmiCategory, dietRecs, sleepRecs, mealPlan);
            
            // Try multiple email services
            const emailSent = await tryEmailServices(userData.email, emailContent);
            
            if (emailSent) {
                setEmailStatus('success', '✅ Email sent successfully! Check your inbox.');
                showNotification('📧 Email sent automatically! Check your inbox.');
            } else {
                setEmailStatus('error', '❌ Failed to send email automatically. Please try the manual options below.');
                showNotification('❌ Email sending failed. Please try manual options.');
            }
            
            setButtonLoading(false);
        }

        // Try multiple email services
        async function tryEmailServices(email, content) {
            // Service 1: EmailJS
            if (await sendWithEmailJS(email, content)) {
                return true;
            }
            
            // Service 2: Formspree
            if (await sendWithFormspree(email, content)) {
                return true;
            }
            
            // Service 3: Netlify Forms
            if (await sendWithNetlify(email, content)) {
                return true;
            }
            
            return false;
        }

        // Send with EmailJS
        async function sendWithEmailJS(email, content) {
            try {
                console.log('📧 Trying EmailJS...');
                
                const templateParams = {
                    to_email: email,
                    subject: `Health Report - ${new Date().toLocaleDateString()}`,
                    message: content,
                    from_name: 'Weight Tracking'
                };
                
                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceId,
                    EMAILJS_CONFIG.templateId,
                    templateParams
                );
                
                console.log('📧 EmailJS success:', response);
                return true;
            } catch (error) {
                console.error('📧 EmailJS failed:', error);
                return false;
            }
        }

        // Send with Formspree
        async function sendWithFormspree(email, content) {
            try {
                console.log('📧 Trying Formspree...');
                
                const formData = new FormData();
                formData.append('email', email);
                formData.append('subject', `Health Report - ${new Date().toLocaleDateString()}`);
                formData.append('message', content);
                formData.append('_replyto', email);
                
                const response = await fetch('https://formspree.io/f/YOUR_FORM_ID', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    console.log('📧 Formspree success');
                    return true;
                } else {
                    throw new Error('Formspree response not ok');
                }
            } catch (error) {
                console.error('📧 Formspree failed:', error);
                return false;
            }
        }

        // Send with Netlify Forms
        async function sendWithNetlify(email, content) {
            try {
                console.log('📧 Trying Netlify Forms...');
                
                const formData = new FormData();
                formData.append('email', email);
                formData.append('subject', `Health Report - ${new Date().toLocaleDateString()}`);
                formData.append('message', content);
                formData.append('form-name', 'health-report');
                
                const response = await fetch('/', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    console.log('📧 Netlify Forms success');
                    return true;
                } else {
                    throw new Error('Netlify response not ok');
                }
            } catch (error) {
                console.error('📧 Netlify Forms failed:', error);
                return false;
            }
        }

        // Set email status
        function setEmailStatus(type, message) {
            const statusDiv = document.getElementById('emailStatus');
            const contentDiv = document.getElementById('emailStatusContent');
            
            statusDiv.className = `email-status status-${type}`;
            contentDiv.innerHTML = message;
            statusDiv.style.display = 'block';
        }

        // Set button loading state
        function setButtonLoading(loading) {
            const btn = document.getElementById('sendEmailBtn');
            if (btn) {
                if (loading) {
                    btn.classList.add('btn-loading');
                    btn.disabled = true;
                    btn.textContent = 'Sending...';
                } else {
                    btn.classList.remove('btn-loading');
                    btn.disabled = false;
                    btn.textContent = 'Send Email Automatically';
                }
            }
        }

        // Generate email content
        function generateEmailContent(bmi, bmiCategory, dietRecs, sleepRecs, mealPlan) {
            return `
Health Report - ${new Date().toLocaleDateString()}

BMI: ${bmi.toFixed(1)} (${bmiCategory})

Diet Recommendations:
${dietRecs.map(rec => `• ${rec}`).join('\n')}

Sleep Recommendations:
${sleepRecs.map(rec => `• ${rec}`).join('\n')}

Comprehensive Meal Plan:
Breakfast Options: ${mealPlan.breakfast.join(', ')}
Lunch Options: ${mealPlan.lunch.join(', ')}
Dinner Options: ${mealPlan.dinner.join(', ')}
Snack Options: ${mealPlan.snacks.join(', ')}

Generated by Weight Tracking
            `.trim();
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                font-weight: 500;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Check if it's time for weekly automation
        function isTimeForWeeklyAutomation() {
            const now = new Date();
            const lastRun = userData.lastWorkflowRun ? new Date(userData.lastWorkflowRun) : null;
            
            // Check if it's Sunday and 9 AM, and hasn't run this week
            if (now.getDay() === 0 && now.getHours() === 9 && now.getMinutes() < 5) {
                if (!lastRun || (now - lastRun) > 7 * 24 * 60 * 60 * 1000) {
                    return true;
                }
            }
            return false;
        }

        // Automated workflow trigger
        async function triggerAutomatedWorkflow() {
            if (!userData.email || !userData.weight || !userData.height || !userData.sleepHours) {
                console.log('Automated workflow skipped: Missing required data');
                return;
            }

            console.log('🤖 Triggering automated weekly workflow...');
            
            // Generate recommendations
            const weightUnit = document.getElementById('weightUnit').value;
            const heightUnit = document.getElementById('heightUnit').value;
            const bmi = calculateBMI(userData.weight, userData.height, weightUnit, heightUnit);
            const bmiCategory = getBMICategory(bmi);
            
            const dietRecs = generateDietRecommendations(bmi);
            const sleepRecs = generateSleepRecommendations(bmi, userData.sleepHours);
            const mealPlan = generateComprehensiveMealPlan(bmi, userData.weightGoal, userData.weight);
            
            // Send automated email
            const emailContent = generateEmailContent(bmi, bmiCategory, dietRecs, sleepRecs, mealPlan);
            await tryEmailServices(userData.email, emailContent);
            
            // Update last run time
            userData.lastWorkflowRun = new Date().toISOString();
            saveUserData();
        }

        // Check for automation every minute
        function checkAutomation() {
            if (userData.automationEnabled && isTimeForWeeklyAutomation()) {
                triggerAutomatedWorkflow();
            }
        }

        // Start automation monitoring
        function startAutomation() {
            setInterval(checkAutomation, 60000); // Check every minute
            console.log('🤖 Workflow automation monitoring started');
        }

        // BMI Calculation
        function calculateBMI(weight, height, weightUnit, heightUnit) {
            let weightKg = weight;
            let heightM = height;
            
            if (weightUnit === 'lbs') {
                weightKg = weight * 0.453592;
            }
            if (heightUnit === 'in') {
                heightM = height * 0.0254;
            } else if (heightUnit === 'cm') {
                heightM = height / 100;
            }
            
            return weightKg / (heightM * heightM);
        }

        // BMI Category
        function getBMICategory(bmi) {
            if (bmi < 18.5) return 'Underweight';
            if (bmi < 25) return 'Normal weight';
            if (bmi < 30) return 'Overweight';
            return 'Obese';
        }

        // Generate Diet Recommendations
        function generateDietRecommendations(bmi) {
            const recommendations = [];
            
            if (bmi < 18.5) {
                recommendations.push('Increase caloric intake with nutrient-dense foods');
                recommendations.push('Include healthy fats: nuts, avocados, olive oil');
                recommendations.push('Eat 3 balanced meals + 2-3 snacks daily');
                recommendations.push('Consider protein shakes between meals');
                recommendations.push('Focus on whole grains and complex carbohydrates');
            } else if (bmi < 25) {
                recommendations.push('Maintain balanced diet with variety of whole foods');
                recommendations.push('Include lean proteins, complex carbs, and vegetables');
                recommendations.push('Stay hydrated with 8+ glasses of water daily');
                recommendations.push('Limit processed foods and added sugars');
                recommendations.push('Include omega-3 fatty acids from fish or supplements');
            } else if (bmi < 30) {
                recommendations.push('Focus on portion control and mindful eating');
                recommendations.push('Increase vegetables and reduce processed foods');
                recommendations.push('Limit added sugars and refined carbohydrates');
                recommendations.push('Include lean proteins with every meal');
                recommendations.push('Consider intermittent fasting under medical supervision');
            } else {
                recommendations.push('Consult healthcare provider for personalized meal plan');
                recommendations.push('Focus on whole, unprocessed foods');
                recommendations.push('Consider working with a registered dietitian');
                recommendations.push('Monitor portion sizes carefully');
                recommendations.push('Consider medical weight management programs');
            }
            
            return recommendations;
        }

        // Generate Sleep Recommendations
        function generateSleepRecommendations(bmi, sleepHours) {
            const recommendations = [];
            const avgSleepPerNight = sleepHours / 7;
            
            if (avgSleepPerNight < 7) {
                recommendations.push('Aim for 7-9 hours of sleep per night');
                recommendations.push('Establish consistent bedtime routine');
                recommendations.push('Avoid screens 1 hour before bed');
                recommendations.push('Create a cool, dark sleeping environment');
                recommendations.push('Consider melatonin supplements if needed');
            } else if (avgSleepPerNight > 9) {
                recommendations.push('Consider if excessive sleep indicates underlying health issues');
                recommendations.push('Maintain consistent sleep schedule');
                recommendations.push('Ensure sleep quality over quantity');
                recommendations.push('Consult healthcare provider if excessive sleep persists');
                recommendations.push('Consider sleep study for sleep quality assessment');
            } else {
                recommendations.push('Maintain current healthy sleep patterns');
                recommendations.push('Keep consistent sleep and wake times');
                recommendations.push('Ensure bedroom is dark, cool, and quiet');
                recommendations.push('Avoid caffeine 6 hours before bedtime');
                recommendations.push('Consider relaxation techniques before bed');
            }
            
            if (bmi > 25) {
                recommendations.push('Poor sleep can affect weight management - prioritize quality rest');
                recommendations.push('Consider sleep apnea screening if snoring occurs');
            }
            
            return recommendations;
        }

        // Generate Comprehensive Meal Plan (Healthcare Provider Level)
        function generateComprehensiveMealPlan(bmi, weightGoal, currentWeight) {
            const mealPlan = {
                breakfast: [],
                lunch: [],
                dinner: [],
                snacks: []
            };
            
            const isWeightLoss = weightGoal && currentWeight > weightGoal;
            const isWeightGain = weightGoal && currentWeight < weightGoal;
            
            if (bmi < 18.5 || isWeightGain) {
                // Weight Gain Meal Plan
                mealPlan.breakfast = [
                    'Oatmeal with nuts, seeds, and dried fruit (500+ calories)',
                    'Greek yogurt parfait with granola and berries',
                    'Whole grain toast with avocado and eggs',
                    'Smoothie with protein powder, banana, and nut butter',
                    'Pancakes with berries and maple syrup',
                    'Scrambled eggs with cheese and whole grain toast'
                ];
                mealPlan.lunch = [
                    'Quinoa bowl with chicken, vegetables, and tahini dressing',
                    'Whole grain pasta with lean meat and vegetables',
                    'Salmon salad with mixed greens and olive oil',
                    'Bean and rice bowl with cheese and vegetables',
                    'Turkey sandwich on whole grain bread with avocado',
                    'Lentil soup with whole grain bread and butter'
                ];
                mealPlan.dinner = [
                    'Grilled chicken with sweet potato and steamed broccoli',
                    'Baked fish with brown rice and roasted vegetables',
                    'Lean beef stir-fry with brown rice noodles',
                    'Turkey meatballs with whole wheat pasta and marinara',
                    'Salmon with quinoa and roasted vegetables',
                    'Chicken curry with brown rice and naan'
                ];
                mealPlan.snacks = [
                    'Mixed nuts and dried fruit (1/4 cup)',
                    'Cheese and whole grain crackers',
                    'Hummus with vegetables and pita',
                    'Greek yogurt with honey and granola',
                    'Trail mix with nuts and seeds',
                    'Peanut butter on whole grain toast'
                ];
            } else if (bmi >= 18.5 && bmi < 25 && !isWeightLoss) {
                // Maintenance Meal Plan
                mealPlan.breakfast = [
                    'Greek yogurt with berries and granola',
                    'Whole grain cereal with milk and fruit',
                    'Eggs with whole grain toast and vegetables',
                    'Overnight oats with nuts and fruit',
                    'Smoothie bowl with spinach, berries, and protein',
                    'Avocado toast with poached egg'
                ];
                mealPlan.lunch = [
                    'Grilled chicken salad with mixed vegetables',
                    'Turkey and vegetable wrap with whole grain tortilla',
                    'Quinoa bowl with vegetables and lean protein',
                    'Lentil soup with whole grain bread',
                    'Tuna salad with mixed greens',
                    'Vegetable stir-fry with tofu and brown rice'
                ];
                mealPlan.dinner = [
                    'Baked salmon with roasted vegetables',
                    'Grilled chicken with quinoa and steamed broccoli',
                    'Vegetable stir-fry with tofu and brown rice',
                    'Lean beef with sweet potato and green beans',
                    'Fish tacos with cabbage slaw',
                    'Chicken and vegetable kebabs'
                ];
                mealPlan.snacks = [
                    'Apple with almond butter',
                    'Vegetable sticks with hummus',
                    'Greek yogurt with berries',
                    'Mixed nuts (small portion)',
                    'Hard-boiled eggs',
                    'Cottage cheese with fruit'
                ];
            } else {
                // Weight Loss Meal Plan
                mealPlan.breakfast = [
                    'Greek yogurt with berries and chia seeds',
                    'Vegetable omelet with whole grain toast',
                    'Overnight oats with protein powder and fruit',
                    'Smoothie bowl with spinach, berries, and protein',
                    'Egg white scramble with vegetables',
                    'Protein pancakes with berries'
                ];
                mealPlan.lunch = [
                    'Large salad with lean protein and olive oil dressing',
                    'Vegetable soup with grilled chicken',
                    'Quinoa bowl with vegetables and light dressing',
                    'Turkey and vegetable lettuce wraps',
                    'Grilled fish with steamed vegetables',
                    'Chicken and vegetable stir-fry'
                ];
                mealPlan.dinner = [
                    'Grilled fish with steamed vegetables',
                    'Baked chicken with roasted vegetables',
                    'Vegetable stir-fry with lean protein',
                    'Turkey meatballs with zucchini noodles',
                    'Salmon with asparagus and quinoa',
                    'Chicken and vegetable kebabs'
                ];
                mealPlan.snacks = [
                    'Celery with almond butter',
                    'Greek yogurt with berries',
                    'Vegetable sticks with hummus',
                    'Apple slices with cinnamon',
                    'Hard-boiled eggs',
                    'Cottage cheese with cucumber'
                ];
            }
            
            return mealPlan;
        }

        // Calculate Timeline
        function calculateTimeline(currentWeight, targetWeight, weightUnit) {
            if (!targetWeight) return null;
            
            const weightDifference = Math.abs(currentWeight - targetWeight);
            const weightDifferenceKg = weightUnit === 'lbs' ? weightDifference * 0.453592 : weightDifference;
            
            const weeklyRate = 0.5; // 0.5 kg per week
            const weeksNeeded = Math.ceil(weightDifferenceKg / weeklyRate);
            
            return {
                totalWeeks: weeksNeeded,
                weeklyRate: weightUnit === 'lbs' ? 1.1 : 0.5,
                isWeightLoss: currentWeight > targetWeight
            };
        }

        // Main function - Opens health plan in new page
        function generateRecommendations() {
            console.log('Generate Health Plan clicked');
            
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const sleepHours = parseFloat(document.getElementById('sleepHours').value);
            const exerciseMinutes = parseFloat(document.getElementById('exerciseMinutes').value);
            const weightGoal = parseFloat(document.getElementById('weightGoal').value);
            const email = document.getElementById('email').value;
            const weightUnit = document.getElementById('weightUnit').value;
            const heightUnit = document.getElementById('heightUnit').value;
            const goalUnit = document.getElementById('goalUnit').value;
            
            console.log('Values:', { weight, height, sleepHours, exerciseMinutes, weightGoal, email });
            
            // Validation
            if (!weight || !height || !sleepHours || exerciseMinutes === null || exerciseMinutes === undefined) {
                alert('Please fill in all required fields (exercise can be 0)');
                console.log('Validation failed: missing required fields');
                return;
            }
            
            console.log('Validation passed, proceeding with calculations');
            
            if (weight < 0 || height < 0 || sleepHours < 0 || exerciseMinutes < 0) {
                alert('Please enter valid non-negative values');
                return;
            }
            
            if (weight === 0 || height === 0 || sleepHours === 0) {
                alert('Weight, height, and sleep hours must be greater than 0');
                return;
            }
            
            if (weightGoal && weightGoal <= 0) {
                alert('Weight goal must be greater than 0');
                return;
            }
            
            // Save user data
            userData.weight = weight;
            userData.height = height;
            userData.sleepHours = sleepHours;
            userData.exerciseMinutes = exerciseMinutes;
            userData.weightGoal = weightGoal;
            userData.email = email;
            saveUserData();
            
            // Calculate BMI
            const bmi = calculateBMI(weight, height, weightUnit, heightUnit);
            const bmiCategory = getBMICategory(bmi);
            
            // Generate recommendations (for email only)
            const dietRecs = generateDietRecommendations(bmi);
            const sleepRecs = generateSleepRecommendations(bmi, sleepHours);
            
            // Generate comprehensive meal plan
            const mealPlan = generateComprehensiveMealPlan(bmi, weightGoal, weight);
            
            // Store current report for email functions
            currentReport = { bmi, bmiCategory, dietRecs, sleepRecs, mealPlan };
            
            // Show meal plan dashboard (like email login -> dashboard)
            showMealPlanDashboard(bmi, bmiCategory, mealPlan, weightGoal, weightUnit);
        }

        // Show meal plan dashboard (SPA-style like email login -> dashboard)
        function showMealPlanDashboard(bmi, bmiCategory, mealPlan, weightGoal, weightUnit) {
            console.log('Showing meal plan dashboard');
            
            // Hide form section
            document.querySelector('.form').style.display = 'none';
            document.querySelector('.automation-status').style.display = 'none';
            
            // Show dashboard section
            document.getElementById('mealPlanDashboard').style.display = 'block';
            
            // Update BMI display
            document.getElementById('resultBmiValue').textContent = bmi.toFixed(1);
            document.getElementById('resultBmiCategory').textContent = bmiCategory;
            
            // Generate meal plan HTML
            let mealPlanHtml = '<h5><i class="fas fa-sun"></i> Breakfast Options:</h5><div class="meal-options">';
            mealPlan.breakfast.forEach(function(meal) {
                mealPlanHtml += '<div class="meal-option">' + meal + '</div>';
            });
            mealPlanHtml += '</div><h5><i class="fas fa-sun"></i> Lunch Options:</h5><div class="meal-options">';
            mealPlan.lunch.forEach(function(meal) {
                mealPlanHtml += '<div class="meal-option">' + meal + '</div>';
            });
            mealPlanHtml += '</div><h5><i class="fas fa-moon"></i> Dinner Options:</h5><div class="meal-options">';
            mealPlan.dinner.forEach(function(meal) {
                mealPlanHtml += '<div class="meal-option">' + meal + '</div>';
            });
            mealPlanHtml += '</div><h5><i class="fas fa-cookie-bite"></i> Snack Options:</h5><div class="meal-options">';
            mealPlan.snacks.forEach(function(meal) {
                mealPlanHtml += '<div class="meal-option">' + meal + '</div>';
            });
            mealPlanHtml += '</div>';
            
            document.getElementById('mealPlanContent').innerHTML = mealPlanHtml;
            
            // Generate timeline HTML
            let timelineHtml = '';
            if (weightGoal) {
                const timeline = calculateTimeline(userData.weight, weightGoal, weightUnit);
                timelineHtml = '<div class="timeline-info"><div class="timeline-item"><div class="timeline-value">' + timeline.totalWeeks + '</div><div class="timeline-label">Total Weeks</div></div><div class="timeline-item"><div class="timeline-value">' + timeline.weeklyRate + '</div><div class="timeline-label">Weekly Change (' + weightUnit + ')</div></div><div class="timeline-item"><div class="timeline-value">' + (timeline.isWeightLoss ? 'Lose' : 'Gain') + '</div><div class="timeline-label">Goal Type</div></div></div>';
            } else {
                timelineHtml = '<p>Set a target weight to see timeline</p>';
            }
            
            document.getElementById('timelineContent').innerHTML = timelineHtml;
            
            console.log('Meal plan dashboard displayed successfully');
        }

        // Go back to form (like back button in email dashboard)
        function goBackToForm() {
            console.log('Going back to form');
            
            // Hide dashboard section
            document.getElementById('mealPlanDashboard').style.display = 'none';
            
            // Show form section
            document.querySelector('.form').style.display = 'block';
            document.querySelector('.automation-status').style.display = 'block';
            
            console.log('Back to form successfully');
        }




        // Reset all data function
        function resetAllData() {
            console.log('Resetting all data');
            
            // Confirm reset action
            if (confirm('Are you sure you want to reset all data? This will clear all form fields and saved data.')) {
                // Clear all form fields
                document.getElementById('weight').value = '';
                document.getElementById('height').value = '';
                document.getElementById('sleepHours').value = '';
                document.getElementById('exerciseMinutes').value = '';
                document.getElementById('weightGoal').value = '';
                document.getElementById('email').value = '';
                document.getElementById('automationEnabled').checked = false;
                
                // Reset units to defaults
                document.getElementById('weightUnit').value = 'kg';
                document.getElementById('heightUnit').value = 'cm';
                document.getElementById('goalUnit').value = 'kg';
                
                // Clear user data
                userData = {
                    weight: null,
                    height: null,
                    sleepHours: null,
                    exerciseMinutes: null,
                    weightGoal: null,
                    email: null,
                    lastWorkflowRun: null,
                    automationEnabled: false
                };
                
                // Clear localStorage
                localStorage.removeItem('healthTrackerData');
                
                // Clear current report
                currentReport = null;
                
                // If on dashboard, go back to form
                if (document.getElementById('mealPlanDashboard').style.display === 'block') {
                    goBackToForm();
                }
                
                // Show success message
                alert('All data has been reset successfully!');
                console.log('All data reset successfully');
            } else {
                console.log('Reset cancelled by user');
            }
        }

        // Test function to verify JavaScript is working
        function testJavaScript() {
            console.log('JavaScript is working!');
            alert('JavaScript is working! Button should be functional now.');
        }

        // Auto-sync units
        // Auto-sync units and initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, JavaScript initialized');
            
            // Check if user is remembered
            const rememberedUser = localStorage.getItem('rememberedUser');
            if (rememberedUser) {
                console.log('Remembered user found:', rememberedUser);
                // Auto-login remembered user
                currentUser = rememberedUser;
                isLoggedIn = true;
                showMainApp();
            } else {
                console.log('No remembered user, showing auth section');
                // Show auth section by default
                document.getElementById('authSection').style.display = 'block';
            }
            
            // Initialize automation
            startAutomation();
            
            // Initialize EmailJS
            initializeEmailJS();
            
            // Auto-sync units
            document.getElementById('weightUnit').addEventListener('change', function() {
                document.getElementById('goalUnit').value = this.value;
            });
            
            document.getElementById('goalUnit').addEventListener('change', function() {
                document.getElementById('weightUnit').value = this.value;
            });
        });
    </script>
</body>
</html>